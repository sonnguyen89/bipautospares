!function(e,r){var t,n,o=!1,f=!1,i=!1,a=!1,c=!1,l=!1,p=!1,u=!1,s=[],d=[],h=[],v={},b=[];e.Abtf.proxy_setup=function(e){if(void 0===r)var r=!1;if(t=e.url||r,o=e.js||!1,f=e.css||!1,(i=e.cdn||!1)&&b.push(i),a=e.js_include||!1,c=e.js_exclude||!1,l=e.css_include||!1,p=e.css_exclude||!1,e.preload){u=!0;for(y=0;y<e.preload.length;y++)"regex"===e.preload[y][0]?(h.push([e.preload[y][2],e.preload[y][3],e.preload[y][1]]),e.preload[y][4]&&(v[e.preload[y][0]]=e.preload[y][4],-1===b.indexOf(e.preload[y][4])&&b.push(e.preload[y][4]))):(s.push(e.preload[y][0]),d.push(e.preload[y][1]),e.preload[y][4]&&(v[e.preload[y][0]]=e.preload[y][4],-1===b.indexOf(e.preload[y][4])&&b.push(e.preload[y][4])));n=e.base||!1}if(0===b.length)b=!1;else for(var m=b.length,y=0;y<m;y++)b[y]=O(b[y])};var m={Element:"undefined"!=typeof Element&&Element,Document:"undefined"!=typeof Document&&Document},y={append:{},insert:{}};for(var g in m)m.hasOwnProperty(g)&&m[g]&&(y.append[g]=m[g].prototype.appendChild,y.insert[g]=m[g].prototype.insertBefore);var x=document.createElement("a");x.href=document.location.href;var O=function(e){var r=document.createElement("a");return r.href=e,r},j=function(e,r){return"css"===r?t.replace("{PROXY:URL}",escape(e)).replace("{PROXY:TYPE}",escape(r)):"js"===r?t.replace("{PROXY:URL}",escape(e)).replace("{PROXY:TYPE}",escape(r)):void 0},U=function(e,t){if(u){var o=s.indexOf(e);if(o>-1)var f=d[o];else if(h.length>0)for(var i,a,c=h.length,l=0;l<c;l++){a=!1;try{i=new RegExp(h[l][0],h[l][1]||"")}catch(e){a=!0}if(!a&&i.test(e)){h[l][2]?f=h[l][2]:h[l][3]&&(e=h[l][3]);break}}if(f){if(void 0!==v[e])p=v[e];else var p=n;p+=f.substr(0,2)+"/",p+=f.substr(2,2)+"/",p+=f.substr(4,2)+"/",p+=f;if("js"===t){if(p+=".js",void 0!==r.cachedScriptUrl){var b=O(p).href;p=r.cachedScriptUrl(b)}}else"css"===t&&(p+=".css");return p}}if("js"===t&&void 0!==r.cachedScriptUrl){var m=O(e).href;if((e=r.cachedScriptUrl(m))!==m)return e}return j(e,t)},P=function(e,r){var t="object"==typeof e&&void 0!==e.href?e:O(e);if("blob:"===t.protocol)return!1;if(b&&!0!==r)for(var n=b.length,o=0;o<n;o++)if(-1!==t.href.indexOf(b[o].href))return!1;return t.host!==x.host},w=function(e){var r="object"==typeof e&&void 0!==e.href?e:O(e);if("blob:"===r.protocol)return!0;if(a){for(var t=!1,n=a.length,o=0;o<n;o++)if(-1!==r.href.indexOf(a[o])){t=!0;break}if(!t)return!0}if(c)for(var n=c.length,o=0;o<n;o++)if(-1!==r.href.indexOf(c[o]))return!0;return!1},C=function(e){var r="object"==typeof e&&void 0!==e.href?e:O(e);if("blob:"===r.protocol)return!1;if(b)for(var t=b.length,n=0;n<t;n++)if(-1!==r.href.indexOf(b[n].href))return!1;return r.host!==x.host},E=function(e){var r="object"==typeof e&&void 0!==e.href?e:O(e);if("blob:"===r.protocol)return!0;if(l){for(var t=!1,n=l.length,o=0;o<n;o++)if(-1!==r.href.indexOf(l[o])){t=!0;break}if(!t)return!0}if(p)for(var n=p.length,o=0;o<n;o++)if(-1!==r.href.indexOf(p[o]))return!0;return!1},R=function(e){if(e.nodeName)if("SCRIPT"===e.nodeName.toUpperCase()){if(!o)return!1;if("abtf"===e.getAttribute("rel"))return e.removeAttribute("rel"),!1;if(e.src){t=O(e.src);if(w(t))return!1;if(!P(t)){if(void 0!==r.cachedScriptUrl){if("blob:"===t.protocol)return!1;url=r.cachedScriptUrl(t.href),url!==t.href&&(e.src=url)}return!1}return"js"}}else if("LINK"===e.nodeName.toUpperCase()&&"stylesheet"===e.rel.toLowerCase()){if(!f)return!1;if("abtf"===e.getAttribute("rel"))return e.removeAttribute("rel"),!1;if(e.href){var t=O(e.href);return!E(t)&&(!!C(t)&&"css")}}return!1},S=function(e){var r=R(e);if(!r)return!1;var t=O("css"===r?e.href:e.src).href,n=U(t,r);"css"===r?e.href=n:"js"===r&&(e.src=n)},A={appendChild:function(e,r){return S(r),y.append[e].call(this,r)},insertBefore:function(e,r,t){return S(r),y.insert[e].call(this,r,t)}};for(var g in m)m.hasOwnProperty(g)&&m[g]&&function(e){m[e].prototype.appendChild=function(r){return A.appendChild.call(this,e,r)},m[e].prototype.insertBefore=function(r,t){return A.insertBefore.call(this,e,r,t)}}(g);e.Abtf.proxifyScript=function(e){return P(e,!0)?j(e,"js"):e}}(window,window.Abtf);